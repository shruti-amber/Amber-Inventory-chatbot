// node --version # Should be >= 18
// npm install @google/generative-ai express

import express from "express";
import {
  GoogleGenerativeAI,
  HarmCategory,
  HarmBlockThreshold,
} from "@google/generative-ai";
const __dirname = import.meta.dirname;

const app = express();
const port = process.env.PORT || 3005;
app.use(express.json());
const MODEL_NAME = "gemini-pro";
const API_KEY = "AIzaSyDpyPSpPnvSvagxATasTSeC-stlIyPKwpg";

async function runChat(userInput) {
  const genAI = new GoogleGenerativeAI(API_KEY);
  const model = genAI.getGenerativeModel({ model: MODEL_NAME });

  const generationConfig = {
    temperature: 0.9,
    topK: 1,
    topP: 1,
    maxOutputTokens: 1000,
  };

  const safetySettings = [
    {
      category: HarmCategory.HARM_CATEGORY_HARASSMENT,
      threshold: HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE,
    },
    // ... other safety settings
  ];

  const chat = model.startChat({
    generationConfig,
    safetySettings,
    history: [
      {
        role: "user",
        parts: [
          {
            text: "Location of the property : Long St, London, E2 8HJ, United Kingdom\\nDistance of the property from city centre : 3.1 mi from City Center\\nPhotos of the property link : https://amberstudent.com/places/flora-building-london-2003182949070?gallery=true&galleryId=149580&tab=all\\nVideo of the property link : https://amberstudent.com/places/flora-building-london-2003182949070?gallery=true&galleryId=149580&tab=floor_plan\\nName of the property : Flora Building â€“ Hoxton, London\\nGoogle Map location link :https://maps.app.goo.gl/vW4TVVfK12XiKwj96\\nOffer 1 Detail : Exclusive Cashback Of GBP 50 For Referring A Friend On Amber!\\nOffers on the property : 1\\nOffer\\nPocket GBP 50 cashback by referring a friend. Friendship is rewarding with amber, win up to GBP 10,000!\\nTo Refer your friend ðŸ‘‰ **https://amberstudent.com/refer** ðŸ‘ˆ\\nHow the referral program works:\\nStep 1: Share your unique referral link\\nInvite friends to experience our service by sharing your custom link with them\\nStep 2: Your friend books a room\\nYour friend secures a reservation using your referral link, ensuring a delightful stay with us\\nStep 3: You get GBP 50 cashback\\nEnjoy a GBP 50 cashback as a token of our appreciation for your referral\\nTerms and conditions\\n\\nYou can refer multiple friends and win cashback upto GBP 10,000!\\nThe referred student must be a new user, not an existing student registered with amber.\\nThe referred student must book in the property that is listed with amber.\\nThe referred student must book a minimum 44-week stay via amber, in a listed property during the 2023â€“24 academic year, unless otherwise stated.\\nThe referral cashback will be processed after 90 days from the date of the student's move-in; they must have made payment to the property, for their instalments as per their tenancy contract.\\nThe referred student must have fulfilled the terms of their tenancy agreement(s) with the property.\\nThis offer is personal to the customer and is non-transferable.\\nThe offer does not apply to students who are rebooking the same apartment.\\nAmber reserves the right to substitute the cashback with an Amazon voucher as an alternate if, for any reason, it is unable to proceed with the cash transfer.\\nAmber employees and their families are not eligible for this offer.\\n\\nNote: These terms and conditions are subject to change without prior notice, and any violation of these terms will result in the disqualification of the Cashback offer.\\nDescription about the property :\\nDescription\\nAbout\\nThe Flora Building â€“ Hoxton is an affordable student accommodation in London with a wide range of rooms available to make your stay comfortable. It is just an eight-minute drive away from the University of Liverpool and Istituto Marangoni.\\nFeatures\\nEach room has a cozy bed, providing unparalleled comfort. With drawers, a large wardrobe, and storage space under the bed, there is plenty of space to keep your belongings. The study area, equipped with a table and seats, offers the perfect environment to focus on academic activities. With its glass-ceramic hobs, oven, and refrigerator, the kitchen is a modern marvel that makes preparing dinner a breeze. Plus, all bills are included in the rent â€“ including those for WiFi, water, electricity, and heating â€“ making budgeting simple.\\nLocation and What's Hot?\\nWalking around Old Market Square (less than a mile away from the property) with companions is like a trip back in time as you take in all the historical charm and vibrant ambiance of this famous place. However, if you are up for a fun evening, visit the Montys Bar or the Polo Bar (the 24/7 open British cafÃ©)\\nCommute\\nThe Hoxton train station is just an eight-minute walk away from the property and provides regular trains to every part of the city. Further, the Stop XN and XP lie close to the property and offer easy commuting options via bus.\\nGot it\\nAmenities Inside the property\\nWhat Will You Get\\nBills Included\\nWiFi\\nWater\\nElectricity\\nHeating\\nCommon Amenities\\nFree on-site gym\\nGames room\\nSky garden\\nVariety of communal areas\\nSafety and Security\\n24/7 CCTV\\nGot it\\nRoom Types in the property : 1 Room Types\\nRoom 1 : Standard Twin\\nNon Ensuite\\nShared Room\\nShared Bathroom\\nShared Kitchen\\nBedrooms\\nDetails of Standard Twin:\\nWhat's in the room? - 2 x 3/4 size double bed with under bed storage - Bathroom cabinet - Coat hooks - Drawers - Iron & ironing board - Kettle - Kitchen bin - Magnetic board - Mirror - Shared kitchen with ceramic hobs, combi oven, and fridge freezer - Shared shower room - Shelves - Study space with desks and chairs - Toaster - Wardrobe - Air conditioning & heating -- Description -- Great to share with a friend, a twin includes two beds, a shower room, and a shared kitchen - Room sizes can vary from 20.28m2 to 20.59m2 - Room types and layouts can vary - All prices listed are per person\\nPhotos of standard twin : https://amberstudent.com/places/flora-building-london-2003182949070\\nGeneral Amenities\\nNon Ensuite\\nShared Room\\nShared Bathroom\\nShared Kitchen\\nBedrooms 1\\nBathrooms 1\\nArea 20.28 - 20.59 Sqm\\nRoom Facilities\\n2 X 3/4 Size Double Bed\\nUnder Bed Storage\\nBathroom Cabinet\\nCoat Hooks\\nDrawers\\nIron & Ironing Board\\nKettle\\nKitchen Bin\\nMagnetic Board\\nMirror\\nKitchen With Ceramic Hobs\\nCombi Oven\\nFridge Freezer\\nShower Room\\nShelves\\nStudy Space With Desks And Chairs\\nToaster\\nWardrobe\\nAir Conditioning & Heating\\nAvailable Tenancies in standard Twin: 2\\nDuration: 47 week\\nMove In : 21 Oct, 2023\\nNote: 3 Instalments | Full Payment\\nÂ£293/wee\\nDuration: 48 week\\nMove In : 14 Oct, 2023\\nNote: 3 Instalments | Full Payment\\nÂ£287/week\\nText tour of the property and room\\nEntrance & Front Desk:\\n\\nBegin at the main mid-rise building.\\nThe first thing you'll see is the leasing office where welcoming desk agents and management await.\\n\\nCommunity Amenities:\\n\\nAdjacent to the office, there's a cozy coffee bar offering complimentary refreshments.\\nA short walk reveals the secure package room for larger mail items.\\n\\nStudy Spaces:\\n\\nVenture down the hallway to find a series of study booths â€” perfect spots for focused work or group projects.\\n\\nParking:\\n\\nExiting the main building, the parking garage offers covered spots for vehicles. Additionally, there's uncovered parking scattered throughout the community.\\n\\nClubhouse & Entertainment:\\n\\nThe heart of the property! Here you'll find:\\n\\nA spacious kitchen often buzzing with resident events.\\nA game room equipped with a pool table, pong table, and shuffleboard.\\nAn inviting sports lounge with ample seating.\\nA serene music lounge, where melodies from a piano or guitar fill the space, also doubles as an atmospheric study spot.\\n\\n\\n\\nOutdoor Area:\\n\\nStep outside to a resort-style pool deck with:\\n\\nA heated pool, accompanied by a unique year-round hot tub.\\nAbundant seating areas, both under the sun and shaded spots with TVs.\\nA spiral staircase leading to an elevated sun deck â€” a DJ's perch during events.\\n\\n\\n\\nFitness & Wellbeing:\\n\\nMoving upstairs, there's an expansive 3700+ sq. ft gym, catering to all fitness needs.\\nAdjacent rooms house a tanning bed and a dedicated spin studio/yoga room equipped with innovative workout tech.\\n\\nStudy Lounge & More:\\n\\nAs you exit the gym, the official study lounge presents itself, complete with a printer. This area is purpose-built for academic excellence.\\n\\nTotal Cancellation policy : 3\\nCancellation policy 1: Cooling Off Period\\nCancellation By You - Cancellation within the Cooling Off Period\\nIf you choose to cancel your booking with property management, you have 14 calendar days after receiving the original Accommodation Offer to do so and get a full refund of the Holding Deposit paid. If you have made your booking less than 14 days before your scheduled check-in date, you may cancel your booking until the earlier of\\n1. 14 days after receipt of the Accommodation Offer email and\\n\\nThe Tenancy Start date on your Tenancy Agreement.\\n\\nYou may cancel your booking by sending an email to the relevant Accommodation Office email address listed on the individual sites contact details on. The property management will refund your Holding Deposit within 7 calendar days of cancellation. If you cancel your booking after the cooling off period has expired, you will not get your Holding Deposit returned to you and you, and your guarantor if reasonable, will be required to meet the obligations set out within the Tenancy Agreement.\\nCancellation policy 2: No Visa No Pay\\nFailure to obtain a UK Visa\\nIf you fail to obtain a UK Visa before the start date of your tenancy, the property management will cancel your Tenancy Agreement and refund any rent payments made, so long as you provide within 72 hours of receiving your official confirmation:\\n\\n\\nSupporting official evidence that your Visa was declined\\n\\n\\nWritten confirmation that you wish to cancel your booking\\n\\n\\nCancellation for any other reason\\nIf you have entered into the Tenancy Agreement and you wish to cancel your booking after the cooling off period has expired and you do not fit into the property management's eligible criteria above, you will not get your Holding Deposit returned to you, and you and your guarantor, will be required to meet the obligations set out within the Tenancy Agreement regardless of whether you have collected your keys.\\nCancellation policy 3: No Place No Pay\\nPeriod From & Including when you have entered into the Tenancy Agreement\\nIf you have entered into the Tenancy Agreement and you cancel your booking after the cooling off period has expired, the property management will release you from the contract up to and including 23rd August 2023 where you meet the following criteria and can provide sufficient evidence:\\nIf you are a first year prospective undergraduate student and your offer of a place at your preferred University/Higher Education institution is withdrawn because of you not achieving the required entry grades or you have surpassed your required entry grades and choose to go to a different University.\\nTo meet the criteria, you will need:\\n\\n\\nTo provide a written rejection letter from your chosen university/higher education institute within 72 hours of your exam results being published\\n\\n\\nTo provide a copy of the acceptance letter from your new university.\\n\\n\\nWhere proof is provided in accordance with these terms and conditions and to the property management's and the landlords reasonable satisfaction, you will be entitled to cancel the booking and you will not be liable for the contractual obligations laid out in the Tenancy Agreement from the date of cancellation.\\nTotal Payment Policies : 4\\nPayment policy 1:\\nBooking Deposit\\n\\n\\nTo secure the booking of a room the student will have to pay a holding deposit.\\n\\n\\nOnce the tenancy commences, this holding deposit becomes a security deposit. It is held with the Tenancy Deposit Scheme.\\n\\n\\nThe Security deposit will be refunded to the student in full at the end of their tenancy if there are no outstanding arrears or damages to their room and/or communal areas.\\n\\n\\nThe deposit will depend on the room type you select. The deposit might change due to availability, please get in touch with your amber agent to know more.\\n\\n\\nPayment policy 2:\\nPayment Instalment Plan\\nRent can be paid in three instalments; typically these are around the same time student loans are paid out.\\nPayment Policy 3:\\nMode Of Payment\\nYou can pay via Recurring Card, Direct Debit or via Bank Transfer.\\nCash and Cheques will not be accepted and will be turned away if presented at site.\\nRecurring Card payments can be selected at the time of booking and Direct Debit can be selected by the online portal. If an alternative method of payment is required, such as a bank transfer, or you wish to change your payment method, please contact the Accommodation Team directly for details.\\nPayment Policy 4:\\nGuarantor Requirement\\n\\n\\nYou need to provide a UK-based guarantor only, in case you wish to pay your rent in three instalments. You do not need to provide a guarantor if you're paying the full annual rent in advance.\\n\\n\\nA guarantor is a person aged 18 or above who accepts joint financial responsibility for the tenancy and is liable to pay the rent if for any reason the student is unable to maintain payment of the rents as they fall due.\\n\\n\\nThe landlord has the right to pursue the guarantor for recovery of outstanding monies therefore, it is important that any guarantor understands their obligations.\\n\\n\\nFrequently Asked Questions (FAQ)\\nHow much is the Holding Deposit and what happens to it?\\nPMG asks to pay a Holding Deposit to secure your room. When your tenancy commences, the Holding Deposit will convert into a refundable Security deposit. All deposits are registered with TDS which is a government accredited Tenancy Deposit Protection Scheme provider. At the end of your tenancy a final inspection of your room will be carried out prior to your move out and if any deductions are required they will be discussed with you at this point. Assuming the room and its belongings are in the same condition as when you moved and you have provided your bank details within PMG Portal you will get your deposit back within 10 working days. If you cancel your room booking within 14 days of your Accommodation Offer then you will be entitled to a full refund. After 14 days, the Holding Deposit is non-refundable*. *not applicable for bookings made at properties in Scotland.\\nIs there an age limit for booking?\\nPMG only accept bookings if you are over 18, with the exception of properties in Scotland where you must be 16 or over. This is due to the legally binding tenancy agreement that every tenant is required to sign when living at Property. They also can only accept people in full time education.\\nDo you provide female only accommodation?\\nPMG do provide female only accommodation in some of their schemes but it is not guaranteed that this will be possible. Please speak to the site team to find out more information.\\nCan I choose who I live with?\\nPMGâ€™s are more than happy to accommodate groups as well as individuals. Where you're not booking in a group, they understand your flat mates will be key to your experience so when you book as an individual, PMG will ask you a series of questions to help us to match you with the perfect flat mates.\\nAm I allowed to have guests?\\nYes. It is your home so you are allowed to have guests visiting you.\\nIs there always a member of staff available?\\nTheir standard office hours are between 10am 5pm. Out-of-office hours are also supported by emergency contacts.\\nAre there social events organized for the residents?\\nAbsolutely! They want their community to suit you, so they wont force you to come to their events but you are always welcome. If you have your own suggestions for them even better.\\nCan I bring my own electrical equipment for cooking, i.e. rice cooker?\\nNo we do not advise you to bring your own electrical cooking equipment for health and safety reasons.\\nWho cleans the room and the communal area?\\nThe students are responsible for their own rooms and communal kitchen within the flat. All other rooms and communal areas are cleaned by the site cleaner.\\nCan I smoke in the accommodation?\\nSmoking is not allowed within the accommodation, however there is a designated smoking area outside the building.\\nWhat happens if I don't get on with my new flat mates? Can I swap rooms?\\nIf you are having any issues please contact the accommodation team in the first instance, we will do all we can to help. In exceptional circumstances it may be possible to move you; however we would look to resolve any issues with you all.\\nWhat if something in my flat breaks or isn't working?\\nDrop them an email or pop into the office to let them know, their on-site Maintenance team will be able to deal with most things.\\nCan I have pets?\\nNo pets are permitted under the term of the tenancy agreement.\\nCan I have my groceries delivered to site?\\nYes. Groceries can be delivered to the reception area, but you are to ensure that you are available to take receipt of the delivery. Delivery drivers are not to be given access to the flats.\\nIs contents insurance included?\\nSome of their accommodation include contents insurance with Endsleigh. By partnering with Endsleigh, the No.1 student insurance provider, they have arranged contents insurance for all their students staying with them in their residence at no cost to you. It is important to find out exactly what you are covered for, as you may find that the contents cover is not sufficient and you need to extend it to protect all of your possessions both inside and outside of your room.\\nDo I have WiFi?\\nYes, WiFi is included in your rent. Youâ€™ll also have a broadband connection in your room on your desk.\\nWhy do I need a guarantor?\\nAll students who wish to pay their rent by using an instalment plan are required to provide a qualified UK Guarantor. This provides them with the security and knowledge that the rent will be paid in full if they were to default on payment.\\nWhat does being a guarantor mean?\\nBy agreeing to be a Guarantor you are signing a legal document stating that you agree to pay the rent and guarantee the behaviour of the resident if they default. Please do not sign this agreement if you do not wish to take on this responsibility.\\nI am an International student and do not have a UK Guarantor?\\nHousing Hand specialises in working with international students and will be able to act as your UK Guarantor. For any further queries you can contact Housing Hand directly.\\nWhat are the payment options for international students?\\nHousing Hand charges a one-off fee that you can either pay up front before the start of your tenancy or in 8 instalments (if on a 12-month contract). For students the fee will is 60% of your monthly rent with the minimum price starting at 295 for 12 months cover. The exact cost depends on your several factors including the amount of your rent, you will be given a no obligation quote for the cost of the service on application.\\nWhat is provided in the bedroom? Do I need to bring my own bedding?\\nFacilities and features can vary; typically you are provided with a bed, a study with a desk and a chair, bookshelves, wardrobe and plenty of storage. Bedding is not provided with each room as most of their students prefer to bring their own, however you can order bedding and kitchen utensils from their friends Unikitout to be delivered to your room prior to your move in.\\nCan you arrange an airport pick up service?\\nMost sites will be more than happy to arrange an airport pick up service for you. You just need to let us know your name, arrival date and time and your flight number, well then arrange the transport for you. Please ensure you have enough UK Sterling to pay the taxi fare and check with your chosen property first.\\nReviews (2)\\n**Jie G (**5 Star )\\n3 months ago\\nFlora Building Hoxton is an excellent choice for me because of its convenient location to school. Overground stations and bus stops are all within walking distance, about 4-minutes. The staff are friendly and helpful as well. I feel safe and cosy here. Read less\\n**Yihui C (**5 star)\\n3 months ago\\nThe best student accommodation I can find in East London! All facilities are new and up-to-date! Even better than shown in the website! All receptionists are so friendly and kind to help recommend to every student who wants to have a fantastic living experience in London!",
          },
        ],
      },
      {
        role: "model",
        parts: [
          {
            text: "**Property Details**\n\n* **Location:** Long St, London, E2 8HJ, United Kingdom\n* **Distance from city centre:** 3.1 miles\n* **Property name:** Flora Building â€“ Hoxton, London\n* **Photos:** https://amberstudent.com/places/flora-building-london-2003182949070?gallery=true&galleryId=149580&tab=all\n* **Video:** https://amberstudent.com/places/flora-building-london-2003182949070?gallery=true&galleryId=149580&tab=floor_plan\n* **Google Map location:** https://maps.app.goo.gl/vW4TVVfK12XiKwj96\n\n**Offers**\n\n* Exclusive Cashback Of GBP 50 For Referring A Friend On Amber!\n\n**Property Features**\n\n* Cozy beds with under-bed storage\n* Drawers, large wardrobes, and storage space\n* Study area with table and seats\n* Modern kitchen with glass-ceramic hobs, oven, and refrigerator\n* All bills included (WiFi, water, electricity, heating)\n\n**Location and Amenities**\n\n* Close to Old Market Square (less than a mile away)\n* Walking distance to Hoxton train station\n* Bus stops nearby\n* On-site gym, games room, Sky garden, and variety of communal areas\n* 24/7 CCTV for safety and security\n\n**Room Types**\n\n* **Standard Twin:**\n    * Non-Ensuite\n    * Shared Room\n    * Shared Bathroom\n    * Shared Kitchen\n    * Bedrooms: 2\n    * Bathrooms: 1\n    * Area: 20.28 - 20.59 Sqm\n\n**Available Tenancies**\n\n* Standard Twin:\n    * Duration: 47 weeks\n    * Move-in: 21 Oct, 2023\n    * Note: 3 Instalments | Full Payment\n    * Â£293/week\n    * Duration: 48 weeks\n    * Move-in: 14 Oct, 2023\n    * Note: 3 Instalments | Full Payment\n    * Â£287/week\n\n**Cancellation Policy**\n\n* Cooling Off Period: 14 calendar days from receiving the Accommodation Offer for a full refund of the Holding Deposit.\n* No Visa No Pay: Refund of rent payments if a UK Visa is not obtained before the tenancy start date.\n* No Place No Pay: Release from the contract up to 23rd August 2023 if certain criteria are met and sufficient evidence is provided.\n\n**Payment Policies**\n\n* Booking Deposit: Holding deposit to secure the room, which becomes a refundable Security deposit at the start of the tenancy.\n* Payment Instalment Plan: Rent can be paid in three instalments.\n* Mode Of Payment: Recurring Card, Direct Debit, or Bank Transfer\n* Guarantor Requirement: UK-based guarantor required only if paying rent in three instalments.\n\n**Frequently Asked Questions**\n\n* Holding Deposit: Converts into a refundable Security deposit at the end of the tenancy.\n* Age Limit: Must be over 18 (except Scotland, where 16+ is allowed)\n* Female Only Accommodation: Available in some schemes.\n* Choosing Roommates: PMG can match you with suitable roommates.\n* Guests: Allowed\n* Staff Availability: Standard office hours with emergency contacts available out-of-hours.\n* Social Events: Organized for residents.\n* Electrical Cooking Equipment: Not allowed for safety reasons.\n* Cleaning: Students are responsible for their own rooms and communal kitchen within the flat, while other areas are cleaned by the site cleaner.\n* Smoking: Not allowed within the accommodation.\n* Room Swaps: Possible in exceptional circumstances.\n* Maintenance: On-site Maintenance team handles repairs.\n* Pets: Not allowed under the tenancy agreement.\n* Grocery Deliveries: Allowed to the reception area.\n* WiFi: Included in the rent.\n* Guarantor: Required for installment plan payments.\n* International Student Guarantor: Housing Hand can act as a UK Guarantor for international students.\n* Bedroom Amenities: Bed, study desks and chairs, bookshelves, wardrobe, storage. Bedding not provided.\n* Airport Pick-up Service: Available upon request.",
          },
        ],
      },
      {
        role: "user",
        parts: [
          {
            text: '- **Property N**ame**: {**AXO Islington}          - **Property Link: { }**          - **Address: {**Holloway Rd, London, N7 6JP, United Kingdom}          - **Location:** {}          - Rating: {4.8/5 (10 reviews)}          - Distance_from_city_center: {4.3 mi from London City Center}          - Nearest Univeristy: {**University of London : 2.7 mi**", â€œCity University of London: 2.8 mi}          - Map_link: "https://maps.app.goo.gl/HvVvfTwSBt7oyhUi6"          - photos_link: "https://amberstudent.com/places/axo-islington-london-1709152706379?gallery=true&galleryId=137456&tab=all#all"          - video_link: "https://amberstudent.com/places/axo-islington-london-1709152706379?gallery=true&galleryId=137456&tab=room#videos"          - **Description: {**              - **About**                                    AXO Islington London is a comfortable and chic **[student housing in London](https://amberstudent.com/places/search/london-1811028205760)**. They offer a range of options for students to move into, including various **ensuites** and **studio apartments**. This London student accommodation is popular among students as it is also close to many universities like **[London Metropolitan University](https://amberstudent.com/places/search/london-metropolitan-university-1811059660607)**, which is a quick drive of 5 minutes. The **[University of London](https://amberstudent.com/places/search/university-of-london-1811237715880)** is also a short drive of 20 minutes. There are a variety of room types available in this Lonon student accommodation, which includes Ensuite Rooms, Bronze, Silver, Gold Ensuits, and Silver and Bronze studio rooms.                                    London is quite popular and has always been a go-to place for people worldwide, whether it be education, business, leisure or being a tourist. London is known for Big Ben, Buckingham Palace, Double Decker busses, Red Telephone booths, world-class museums, lush and big wide parks, financial districts, and its numerous educational institutions. London is also the hub for music, art, fashion, food, and acting and is a diplomatic and business hub. London was previously the hub of the industrial revolution and had many factories around the city. London is an amazing city for students as being a hub for multiple things; a student can find multiple opportunities and open new paths for themselves.                                - **Features**                                    AXO Islington London provides a range of stylish en-suites and studios. You can choose en-suite rooms if you want to socialise with other people or live with your pals. A **comfortable bed**, a **fridge,** a **closet**, a **private bathroom**, a **TV**, and a **desk with a chair** are all included. The living room and kitchen are shared by you and your roommates. AXO Islington London also has chic studios with your own **kitchen**, **living space**, and **bathroom** if you like to have your own private space. Students can have full access to common amenities such as **free high-speed WiFi,** **bike storage**, and a **communal area with a TV** and **pool table** where they can hang out with their friends. To make your stay pleasurable and guarantee no issues, there is round-the-clock security, CCTV monitoring, a safe door entry system, and a warm and committed on-site crew. Not just this! Climate change is happening, and everyone needs to understand the urgency of this situation. To create awareness for this, the property has come up with a unique green initiative. They have teamed up with JUST ONE TREE  to provide students with the perfect gift. A  tree will be planted in your name to help overcome global warming every time you book a stay with this London student accommodation. Planting a tree is planting a seed of peace and hope!                                - **Location and What\'s Hot?**                                    Drop by **Big Red,** a coal-black US-style rock bar with a powerful jukebox, frequent host to bands and music fairs, which is just a 5-minute walk. Or you can grab a bite with your mates at **The Swimmer at the Grafton Arms,** and **Bisha Eritrean Restaurant** and **Picholine Restaurant** could be your go-to place for every weekend. There are many popular clubs in London, including **Fabric**, which hosts international DJs and has one of the biggest dancefloors in the UK. They host famous DJs like Skrillex, four Tet and Fred Again.  One of the most popular and iconic locations is **Printworks**. This club can host up to 6,000 people and is one of the biggest printing press complexes in Western Europe.  You can always visit famous tourist sites like **The Tower of London**, **Big Ben** and **Madame Tussauds**. If you are someone who likes a peek into the history of the world, you must visit the **British Museum** and see artefacts from all over the world. There are many gourmet restaurants to choose from, too, like **Boono Indian Tapas** which is the most famous Indian restaurant in London. If you are someone who likes Mediterranean food, you should definitely try **Hibox** for special occasions and amazing bites from the Mediterranean.                                - **Commute**                                    The closest bus stop, **Manor Gardens(Stop V)**, is just down the lane. It is just a 10-minute walk to both **Upper Holloway** and **Archway underground** stations to board any trains from your London student accommodation. There are many banks close to your student housing in London, like  **Barclays Bank, NatWest and Halifax Walk**, which are a walk between 7-15 minutes. End your search for student housing in London by choosing AXO Islington!                                - **Pet policy**                                    Pets are not allowed. Do not keep any animal, bird, insect or reptile in the Room, the Flat Common Areas or the Building Common Areas.                                              }                                  - Offers: {              - Offer 1 title: "**Get An Additional Â£20 Cashback By Booking Via The Amber App**"                            - Offer 2 title: "**Exclusive Cashback Of Â£50 For Referring A Friend On Amber!**"              - Offer 2 Details: " Pocket Â£50 cashback by referring a friend. Friendship is rewarding with amber, win up to Â£10,000! To Refer your friend ðŸ‘‰ **https://amberstudent.com/refer** ðŸ‘ˆ                                    **How the referral program works:**                                    **Step 1: Share your unique referral link**                                    Invite friends to experience our service by sharing your custom link with them                                    **Step 2: Your friend books a room**                                    Your friend secures a reservation using your referral link, ensuring a delightful stay with us                                    **Step 3: You get Â£50 cashback**                                    Enjoy a Â£50 cashback as a token of our appreciation for your referralâ€                                    }                            - Amenities: {              - **Your Rent Include**: â€œ                  - Wifi                  - Water                  - Electricity                  - Heatingâ€              - Common Amenities:â€                  - Bike Storage                  - Communal Spaces                  - Launderette                  - On site maintenance                  - Outdoor Area                  - Social/Events Calendar                  - Pool Table                  - Bike Storage              - **Safety and Security:â€**                  - Secure site with CCTV                  - Electronic key card is required to enter and exit the site                  - 24/7 Onsite Securityâ€          - Room_Types:              - Room Type 1:              - Room Type description: ""              - Room Type 1 Facilities:              - Room Type 1 Photos:"https://amberstudent.com/places/flora-building-london-2003182949070"              - Room Type 1 Tenancies:                  - duration: "47 week"                  move_in_date: "21 Oct, 2023"                  price_per_week: Â£293                  - - duration: "48 week"                  move_in_date: "14 Oct, 2023"                  price_per_week: Â£287                    - Cancellation_policies: {              - **Cancellation Policy 1 Title:** "**Cooling Off Period**"              **Cancellation Policy 1 Title  Details: â€œ Cooling Off Period (Before July 30):** A 7-day cooling-off period applies to all offers accepted before July 30. Students are eligible for a full refund if canceled within this cooling-off period. **Cooling Off Period (After July 30):** A 24-hour cooling-off period applies to all offers accepted after July 30. Students are eligible for a full refund if canceled within this cooling-off period. **Cancel Before June 1**: If canceled for any reasons before June 1, the Booking Deposit will be retained as a cancellation fee. Any additional payments made towards the booking will be refunded. **Cancel After June 1:** No refund will be provided for cancellations made after June 1.**Late Cancellation:** Any reasons for cancellation given after June 1 will be considered invalid, unless cooling-off period conditions are met.â€              - **Cancellation Policy 2 Title:** "**No Visa No Pay**"              **Cancellation Policy 2 Title  Details: â€œ**If you are denied a VISA and as a result cannot enter the UK to partake in your University degree, then you can cancel your booking with no obligation to the contract, so long as evidence of the VISA denial is sent, via email, to the property within 2 days of the letter/correspondence date. On receipt of the required documentation it will be verified and, provided that the property is satisfied, they will cancel your agreement. **Visa Refusal - 2 Weeks Prior to Check-in:** If the cancellation occurs 2 weeks prior to the check-in date due to visa refusal, the Booking Deposit is non-refundable. **Visa Refusal - 0-2 Weeks Prior to Check-in:** If the cancellation occurs 0-2 weeks prior to the check-in date due to visa refusal, 2 weeks\' accommodation fee + the Booking Deposit will be retained as a cancellation fee. **After Contract Start Date and Collecting Keys:** No refund will be made. **After Contract Start Date and Not Collecting Keys:** The accommodation fee accumulated from the contract starting date until the date of notification to the Amber of visa application refusal will be charged. The Student must provide ev              - **Cancellation Policy 3 Title:** "**No Place No Pay**"              **Cancellation Policy 3 Title  Details: â€œ** If you are a prospective first year undergraduate student, a rebooking student or a postgraduate student and your offer of a place at your preferred University/Higher Education Institution is withdrawn by the University/Higher Education Institution as a result of you not achieving the required grades, you may be eligible to be released from this agreement. You may also be eligible to be released from this agreement if you are a prospective first year undergraduate student and you choose to go to a different University because you have exceeded your expected grades. To apply to be released from this agreement in the circumstances referred to above, you will need to supply the property with a copy of: **1. A written rejection letter from your chosen university/college or UCAS or a screenshot of your UCAS status which confirms that the required results were not achieved; or 2. A copy of the proof of acceptance of your new university by UCAS adjustment. These document(s) must be received by the property via email within 2 calendar days from the date your results are published. On receipt of the required documentation it will be verified and, provided they are satisfied, they will cancel your agreement. CAS Refusal - 2 Weeks Prior to Check-in:** If the cancellation occurs 2 weeks prior to the check-in date due to visa refusal, the Booking Deposit is non-refundable. **CAS Refusal - 0-2 Weeks Prior to Check-in:** If the cancellation occurs 0-2 weeks prior to the check-in date due to visa refusal, 2 weeks\' accommodation fee + the Booking Deposit will be retained as a cancellation fee. **After Contract Start Date and Collecting Keys:** No refund will be made.**After Contract Start Date and Not Collecting Keys:** The accommodation fee accumulated from the contract starting date until the date of notification to the Amber of CAS application refusal will be charged. The student must provide evidence, such as a visa refusal letter.              - **Cancellation Policy 4 Title:** "**Replacement Tenant Found**"              **Cancellation Policy 4 Title  Details:**                            A student is liable to pay rent until they arrange for a replacement tenant after cooling off period.                            1. The replacement terms are mentioned as follows:                  1. 100 GBP charged as a processing fee for replacements.                  2. Before move-in date, the original tenant is liable for rent till the replacement tenant has signed the AST, paid the deposit, and till the cooling-off ****period has passed.                  3. Post move in date, the original tenant is liable for rent till the replacement tenant has signed the AST, paid the deposit, and until the tenancy start date of the replacement tenant.                  4. The processing fee will be adjusted with the deposit and if there is a balance amount, it will be refunded back to the original tenant                    }                    - Property FAQs              - Question 1: "How much is the Holding Deposit and what happens to it?"              Answer 1:  â€œ â€                        - Reviews:              - Review 1:              - Review 2:',
          },
        ],
      },
      {
        role: "model",
        parts: [
          {
            text: "**Property Details**\n\n* **Property Name:** AXO Islington\n* **Property Link:** https://amberstudent.com/places/axo-islington-london-1709152706379\n* **Address:** Holloway Rd, London, N7 6JP, United Kingdom\n* **Location:** N/A\n* **Rating:** 4.8/5 (10 reviews)\n* **Distance from City Center:** 4.3 miles\n* **Nearest Universities:**\n    * University of London: 2.7 miles\n    * City University of London: 2.8 miles\n* **Map Link:** https://maps.app.goo.gl/HvVvfTwSBt7oyhUi6\n* **Photos Link:** https://amberstudent.com/places/axo-islington-london-1709152706379?gallery=true&galleryId=137456&tab=all#all\n* **Video Link:** https://amberstudent.com/places/axo-islington-london-1709152706379?gallery=true&galleryId=137456&tab=room#videos\n\n**Description**\n\nAXO Islington offers a range of stylish en-suite rooms and studios for students seeking comfortable and chic accommodation in London.\n\n**Features**\n\n* En-suite rooms with private bathrooms\n* Fully equipped kitchens in studio apartments\n* Free high-speed WiFi\n* Bike storage\n* Communal areas with TV, pool table, and social events\n* 24/7 security and CCTV monitoring\n* Green initiative: Planting a tree for every booking\n\n**Location and What's Hot?**\n\n* Short walk to Big Red coal-black US-style rock bar\n* Nearby restaurants include The Swimmer at the Grafton Arms, Bisha Eritrean Restaurant, and Picholine Restaurant\n* Popular clubs in the area: Fabric and Printworks\n* Historic landmarks: The Tower of London, Big Ben, and Madame Tussauds\n* Gourmet restaurants: Boono Indian Tapas and Hibox\n\n**Commute**\n\n* Closest bus stop: Manor Gardens (Stop V), a 1-minute walk away\n* Upper Holloway and Archway underground stations are within a 10-minute walk\n\n**Amenities**\n\n**Your Rent Includes:**\n\n* WiFi\n* Water\n* Electricity\n* Heating\n\n**Common Amenities:**\n\n* Bike Storage\n* Communal Spaces\n* Launderette\n* On-site maintenance\n* Outdoor Area\n* Social/Events Calendar\n* Pool Table\n\n**Safety and Security:**\n\n* Secure site with CCTV\n* Electronic key card access\n* 24/7 Onsite Security\n\n**Room Types**\n\n* No specific room types mentioned in the provided text.\n\n**Tenancies**\n\n* No specific tenancies mentioned in the provided text.\n\n**Cancellation Policies**\n\n* Cooling Off Period: 7-day cooling-off period for offers accepted before July 30 and a 24-hour cooling-off period for offers accepted after July 30.\n* No Visa No Pay: Cancellation without obligation if a UK Visa is denied.\n* No Place No Pay: Cancellation if an offer of a place at the preferred university/higher education institution is withdrawn or if a different university is chosen due to exceeding expected grades (conditions apply).\n* Replacement Tenant Found: Students are liable for rent until a replacement tenant is found, with specific terms and conditions outlined.\n\n**Offers**\n\n* Additional Â£20 Cashback for bookings made via the Amber App\n* Exclusive Cashback of Â£50 for referring a friend\n\n**Pet Policy**\n\n* Pets are not allowed.\n\n**Reviews**\n\nNo reviews provided in the given text.",
          },
        ],
      },
    ],
  });

  const result = await chat.sendMessage(userInput);
  const response = result.response;
  return response.text();
}

app.get("/", (req, res) => {
  res.sendFile(__dirname + "/index.html");
});
app.get("/loader.gif", (req, res) => {
  res.sendFile(__dirname + "/loader.gif");
});
app.get("/script.js", (req, res) => {
  res.sendFile(__dirname + "/script.js");
});
app.post("/chat", async (req, res) => {
  try {
    const userInput = req.body?.userInput;
  
    if (!userInput) {
      return res.status(400).json({ error: "Invalid request body" });
    }

    const response = await runChat(userInput);
    res.json({ response });
  } catch (error) {
    console.error("Error in chat endpoint:", error);
    res.status(500).json({ error: "Internal Server Error" });
  }
});

app.listen(port, () => {
  console.log(`Server listening on port ${port}`);
});

